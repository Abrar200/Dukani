{% extends "business/base.html" %}

{% load static %}

{% block slider %}

<div class="breadcrumb-block style-shared">
    <div class="breadcrumb-main bg-linear overflow-hidden">
        <div class="container lg:pt-[134px] pt-24 pb-10 relative">
            <div class="main-content w-full h-full flex flex-col items-center justify-center relative z-[1]">
                <div class="text-content">
                    <div class="heading2 text-center">{{ business.business_name }}</div>
                    <div class="link flex items-center justify-center gap-1 caption1 mt-3">
                        <a href='{% url "home" %}'>Home</a>
                        <i class="ph ph-caret-right text-sm text-secondary2"></i>
                        <a href='{% url "business_detail" business.business_slug %}'>{{ business.business_name }}</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock slider %}

{% block content %}


<div class='store-list' style="margin-top: 20px">
    <div class="container">
        <div class="item bg-surface overflow-hidden flex flex-col md:flex-row">
            <div class="md:w-1/5 p-6 flex flex-row mr-4">
                <img src='{{ business.profile_picture.url }}' alt='business_profile'
                     class='w-20 h-20 rounded-full object-cover mr-4' />
                <div class="text-content">
                    <div class="heading3">{{ business.business_name }}</div>
                    {% if request.user.is_authenticated and request.user == business.seller %}
                        <a href="{% url 'edit_business' business.business_slug %}">
                            <div class="quick-view-btn button-main sm:py-1.5 py-1 sm:px-2.5 px-2 bg-black hover:bg-green text-white rounded-full whitespace-nowrap mt-2.5">
                                Edit Your Business
                            </div>
                        </a>
                    {% else %}
                        <a href="{% url 'message_seller' business.business_slug %}">
                            <div class="quick-view-btn button-main sm:py-1.5 py-1 sm:px-2.5 px-2 bg-black hover:bg-green text-white rounded-full whitespace-nowrap mt-2.5">
                                Message Seller
                            </div>
                        </a>
                    {% endif %}
                    {% if request.user.is_authenticated and request.user == business.seller %}
                        <form action="{% url 'delete_business' business.business_slug %}" method="post" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="quick-view-btn button-main sm:py-1.5 py-1 sm:px-2.5 px-2 bg-red hover:bg-green text-white rounded-full whitespace-nowrap mt-2.5">
                                Delete Business
                            </button>
                        </form>
                    {% endif %}
                    {% if request.user.is_authenticated and request.user == business.seller %}
                        <a href="{% url 'business_orders' business.business_slug %}">
                            <button type="submit" class="quick-view-btn button-main sm:py-1.5 py-1 sm:px-2.5 px-2 bg-black hover:bg-green text-white rounded-full whitespace-nowrap mt-2.5">
                                Orders {% if business_order_count > 0 %}
                                ({{ business_order_count }})
                            {% endif %}
                            </button>

                        </a>
                    {% endif %}
                </div>
            </div>
            <div class="sm:w-3/4 flex flex-wrap">
                <div class="w-1/2 sm:w-1/3 mb-2 sm:mb-0">
                    <div class="text-sm font-semibold">Address:</div>
                    <div class="text-xs text-gray-600">{{ business.address }}</div>
                </div>
                <div class="w-1/2 sm:w-1/3">
                    <div class="text-sm font-semibold">Contact:</div>
                    <div class="text-xs text-gray-600">{{ business.phone }}<br/>{{ business.email }}</div>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="shop-square">
    <div class="shop-product">
        <div class="container">
            <div class="list-product-block style-grid relative">

                {% if messages %}
                    <div class="container mt-3">
                        {% for message in messages %}
                            <div class="alert alert-{{ message.tags }}" role="alert">
                                {{ message }}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}

                {% if business.products %}
                
                <div class="filter-heading flex items-center justify-between gap-5 flex-wrap">
                    <div class="left flex has-line items-center flex-wrap gap-5">
                        <div class="heading6 mt-7">Products</div>
                        {% if request.user.is_authenticated and request.user == business.seller %}
                            <a href="{% url 'product_create' business.business_slug %}"><div
                                class="quick-view-btn button-main sm:py-3 py-2 sm:px-5 px-4 bg-black hover:bg-green text-white rounded-full whitespace-nowrap mt-6">
                                Add Products
                            </div></a>
                        {% endif %}
                    </div>
                </div>

                <div class="list-product hide-product-sold grid sm:grid-cols-3 grid-cols-2 sm:gap-[30px] gap-[20px] mt-7 lg:grid-cols-4" data-item="12">
                    {% for product in products %}
                        <div class="product-item grid-type">
                            <div class="product-main cursor-pointer block" data-item="2">
                                <div class="product-thumb bg-white relative overflow-hidden rounded-2xl">
                                    <div class="product-tag text-button-uppercase bg-green px-3 py-0.5 inline-block rounded-full absolute top-3 left-3 z-[1]">New</div>
                                    <div class="product-img w-full h-full aspect-[3/4]">
                                        <a href="{% url "product_detail" product.business.business_slug product.product_slug %}">
                                        <img key="0" class="w-full h-full object-cover duration-700" src="{{ product.image.url }}" alt="img"><img key="1" class="w-full h-full object-cover duration-700" src="{{ product.image2.url }}" alt="img">
                                        </a>
                                    </div>
                                    <div class="list-action grid grid-cols-2 gap-3 px-5 absolute w-full bottom-5 max-lg:hidden">
                                        <div class="quick-view-btn w-full text-button-uppercase py-2 text-center rounded-full duration-300 bg-white hover:bg-black hover:text-white"
                                            data-product-slug="{{ product.product_slug }}"
                                            data-business-slug="{{ business.business_slug }}">
                                            Quick View
                                        </div>

                                   <script>

                                    function updateQuickViewModal(data) {
                                        document.getElementById("quickview-name").innerText = data.name;
                                        document.getElementById("quickview-price").innerText = `$${data.price}`;
                                        document.getElementById("quickview-description").innerText = data.description;
                                        document.getElementById("quickview-sku").innerText = data.sku;
                                        document.getElementById("quickview-categories").innerText = data.categories.join(", ");
                                        document.getElementById("quickview-tags").innerText = data.tags.join(", ");
                                      
                                        const imagesContainer = document.getElementById("quickview-images");
                                        imagesContainer.innerHTML = "";
                                        data.images.forEach(imageUrl => {
                                            const imgElement = document.createElement("div");
                                            imgElement.className = "bg-img w-full aspect-[3/4] max-md:w-[150px] max-md:flex-shrink-0 rounded-[20px] overflow-hidden md:mt-6";
                                            imgElement.innerHTML = `<img src="${imageUrl}" alt="product image" class="w-full h-full object-cover">`;
                                            imagesContainer.appendChild(imgElement);
                                        });
                                      
                                        const colorsContainer = document.getElementById("quickview-colors");
                                        colorsContainer.innerHTML = "";
                                        data.color_variations.forEach(variation => {
                                            const colorItem = document.createElement("div");
                                            colorItem.classList.add("color-item", "w-12", "h-12", "rounded-xl", "duration-300", "relative");
                                            colorItem.dataset.variationId = variation.values__id;
                                            colorItem.dataset.color = variation.values__value;
                                      
                                            if (variation.values__image) {
                                                const imgElement = document.createElement("img");
                                                imgElement.src = `/product_variations/${variation.values__image.split('/').pop()}`; // Update the image URL here
                                                imgElement.alt = "color";
                                                imgElement.classList.add("rounded-xl");
                                                colorItem.appendChild(imgElement);
                                            }
                                      
                                            const tagAction = document.createElement("div");
                                            tagAction.classList.add("tag-action", "bg-black", "text-white", "caption2", "capitalize", "px-1.5", "py-0.5", "rounded-sm");
                                            tagAction.innerText = variation.values__value;
                                            colorItem.appendChild(tagAction);
                                      
                                            colorItem.addEventListener("click", function() {
                                                colorsContainer.querySelectorAll('.color-item').forEach(i => i.classList.remove('active'));
                                                colorItem.classList.add('active');
                                                document.querySelector('#selected-color').innerText = `Color: ${variation.values__value}`;
                                            });
                                      
                                            colorsContainer.appendChild(colorItem);
                                        });
                                      
                                        const sizesContainer = document.getElementById("quickview-sizes");
                                        sizesContainer.innerHTML = "";
                                        data.size_variations.forEach(variation => {
                                          const sizeItem = document.createElement("div");
                                          sizeItem.classList.add("size-item", "w-12", "h-12", "flex", "items-center", "justify-center", "text-button", "rounded-full", "bg-white", "border", "border-line");
                                          sizeItem.dataset.variationId = variation.values__id;
                                          sizeItem.dataset.size = variation.values__value;
                                          sizeItem.innerText = variation.values__value;
                                      
                                          sizeItem.addEventListener("click", function() {
                                            sizesContainer.querySelectorAll('.size-item').forEach(i => i.classList.remove('active'));
                                            sizeItem.classList.add('active');
                                            document.querySelector('#selected-size').innerText = `Size: ${variation.values__value}`;
                                          });
                                      
                                          sizesContainer.appendChild(sizeItem);
                                        });
                                    }

                                    document.addEventListener("DOMContentLoaded", function() {
                                        const quickViewButtons = document.querySelectorAll(".quick-view-btn");
                                        const modalQuickViewBlock = document.querySelector(".modal-quickview-block");
                                        const closeQuickViewButton = document.querySelector(".modal-quickview-block .close-btn");
                                
                                        quickViewButtons.forEach(button => {
                                            button.addEventListener("click", function() {
                                                const productSlug = button.dataset.productSlug;
                                                const businessSlug = button.dataset.businessSlug;
                                
                                                console.log('Quick View Button:', button);
                                                console.log('Product Slug:', productSlug);
                                                console.log('Business Slug:', businessSlug);
                                
                                                if (!productSlug || !businessSlug) {
                                                    console.error('Product Slug or Business Slug is missing');
                                                    return;
                                                }
                                
                                                fetch(`/ajax/product/${businessSlug}/${productSlug}/`)
                                                    .then(response => {
                                                        console.log('Response status:', response.status);
                                                        if (!response.ok) {
                                                            throw new Error('Network response was not ok');
                                                        }
                                                        return response.json();
                                                    })
                                                    .then(data => {
                                                        console.log('Data:', data);
                                                        updateQuickViewModal(data);
                                                        modalQuickViewBlock.style.display = "block";
                                                    })
                                                    .catch(error => {
                                                        console.error('Error:', error);
                                                    });
                                            });
                                        });
                                
                                        closeQuickViewButton.addEventListener("click", function() {
                                            modalQuickViewBlock.style.display = "none";
                                        });
                                
                                        modalQuickViewBlock.addEventListener("click", function(event) {
                                            if (event.target === modalQuickViewBlock) {
                                                modalQuickViewBlock.style.display = "none";
                                            }
                                        });
                                    });

                                       console.log('Product ID from template:', {{ product.id|safe }});
                                       const quickViewButtons = document.querySelectorAll('.quick-view-btn');
                                   
                                       quickViewButtons.forEach(button => {
                                           button.addEventListener('click', () => {
                                               const productSlug = button.dataset.productSlug;
                                               const businessSlug = button.dataset.businessSlug;
                                   
                                               console.log('Quick View Button:', button);
                                               console.log('Product Slug:', productSlug);
                                               console.log('Business Slug:', businessSlug);
                                   
                                               if (!productSlug || !businessSlug) {
                                                   console.error('Product Slug or Business Slug is missing');
                                                   return;
                                               }
                                   
                                               fetch(`/ajax/product/${businessSlug}/${productSlug}/`)
                                               .then(response => {
                                                   console.log('Response status:', response.status);
                                                   if (!response.ok) {
                                                       throw new Error('Network response was not ok');
                                                   }
                                                   return response.json();
                                               })
                                               .then(data => {
                                                   console.log('Data:', data);
                                                   updateQuickViewModal(data);
                                                   modalQuickViewBlock.style.display = "block";
                                               })
                                               .catch(error => {
                                                   console.error('Error:', error);
                                               });
                                           });
                                       });
                                   </script>
                                            <script>
                                                console.log('Product JSON data:', '{{ product.get_json_data }}');
                                            </script>
                                            
                                            <a href="{% url 'quick_shop' product.product_slug %}">
                                                <div class="quick-shop-btn text-button-uppercase py-2 text-center rounded-full duration-500 bg-white hover:bg-black hover:text-white">
                                                    Quick Buy
                                                </div>
                                            </a>
                                       
                                            
                                                <div class="quick-shop-block absolute left-5 right-5 bg-white p-5 rounded-[20px]">
                                                    <div class="list-size flex items-center justify-center flex-wrap gap-2">
                                                        <div key="0" class="size-item w-10 h-10 rounded-full flex items-center justify-center text-button bg-white border border-line">XS</div><div key="1" class="size-item w-10 h-10 rounded-full flex items-center justify-center text-button bg-white border border-line">S</div><div key="2" class="size-item w-10 h-10 rounded-full flex items-center justify-center text-button bg-white border border-line">M</div><div key="3" class="size-item w-10 h-10 rounded-full flex items-center justify-center text-button bg-white border border-line">L</div><div key="4" class="size-item w-10 h-10 rounded-full flex items-center justify-center text-button bg-white border border-line">XL</div><div key="5" class="size-item w-10 h-10 rounded-full flex items-center justify-center text-button bg-white border border-line">2XL</div>
                                                    </div>
                                                    <div class="add-cart-btn button-main w-full text-center rounded-full py-3 mt-4">
                                                        Buy Now
                                                    </div>
                                                    </div>
                                
                                            </div>
                                        </div>
                                        <div class="product-infor mt-4 lg:mb-7">
                                            <div class="product-name text-title duration-300"><a href="{% url "product_detail" product.business.business_slug product.product_slug %}">{{ product.name }}</a></div>
                                                {% if product.variation %}
                                                    <div class="list-color list-color-image max-md:hidden flex items-center gap-3 flex-wrap duration-500">
                                                        
                                                            <div class="color-item w-12 h-12 rounded-xl duration-300 relative" key="0">
                                                                <img src="./assets/images/product/color/white.png" alt="color" class="rounded-xl w-full h-full object-cover">
                                                                <div class="tag-action bg-black text-white caption2 capitalize px-1.5 py-0.5 rounded-sm">white</div>
                                                            </div>
                                                        
                                                            <div class="color-item w-12 h-12 rounded-xl duration-300 relative" key="1">
                                                                <img src="./assets/images/product/color/purple.png" alt="color" class="rounded-xl w-full h-full object-cover">
                                                                <div class="tag-action bg-black text-white caption2 capitalize px-1.5 py-0.5 rounded-sm">purple</div>
                                                            </div>
                                                        
                                                    </div>
                                                {% endif %}
                                            
                                    <div class="product-price-block flex items-center gap-2 flex-wrap mt-1 duration-300 relative z-[1]">
                                    <div class="product-price text-title">${{ product.price }}</div>
                                    
                                        </div>
                                    </div>
                                </div>
                            
                        </div>
                    {% endfor %}
                </div>
                {% endif %}

                {% if business.services %}
               
                <div class="filter-heading flex items-center justify-between gap-5 flex-wrap">
                    <div class="left flex has-line items-center flex-wrap gap-5">
                        <div class="heading6 mt-7">Services</div>
                        {% if request.user.is_authenticated and request.user == business.seller %}
                            <a href="{% url 'service_create' business.business_slug %}"><div
                                class="quick-view-btn button-main sm:py-3 py-2 sm:px-5 px-4 bg-black hover:bg-green text-white rounded-full whitespace-nowrap mt-6">
                                Add Services
                            </div></a>
                        {% endif %}
                    </div>
                </div>

                    <div class="list-product hide-product-sold grid sm:grid-cols-3 grid-cols-2 sm:gap-[30px] gap-[20px] mt-7 lg:grid-cols-4" data-item="12">
                        {% for service in services %}
                        <div class="product-item grid-type">
                            <div class="product-main cursor-pointer block" data-item="2">
                                <div class="product-thumb bg-white relative overflow-hidden rounded-2xl">
                                    <div class="product-tag text-button-uppercase bg-green px-3 py-0.5 inline-block rounded-full absolute top-3 left-3 z-[1]">New</div>
                                    <div class="product-img w-full h-full aspect-[3/4]">
                                        <a href="{% url "service_detail" service.business.business_slug service.service_slug %}">
                                        <img key="0" class="w-full h-full object-cover duration-700" src="{{ service.image.url }}" alt="img"><img key="1" class="w-full h-full object-cover duration-700" src="{{ product.image2.url }}" alt="img">
                                        </a>
                                    </div>
                                    <div class="list-action grid grid-cols-2 gap-3 px-5 absolute w-full bottom-5 max-lg:hidden">
                                        
                                       
                                            
                                                <div class="quick-shop-block absolute left-5 right-5 bg-white p-5 rounded-[20px]">
                                                    <div class="list-size flex items-center justify-center flex-wrap gap-2">
                                                        <div key="0" class="size-item w-10 h-10 rounded-full flex items-center justify-center text-button bg-white border border-line">XS</div><div key="1" class="size-item w-10 h-10 rounded-full flex items-center justify-center text-button bg-white border border-line">S</div><div key="2" class="size-item w-10 h-10 rounded-full flex items-center justify-center text-button bg-white border border-line">M</div><div key="3" class="size-item w-10 h-10 rounded-full flex items-center justify-center text-button bg-white border border-line">L</div><div key="4" class="size-item w-10 h-10 rounded-full flex items-center justify-center text-button bg-white border border-line">XL</div><div key="5" class="size-item w-10 h-10 rounded-full flex items-center justify-center text-button bg-white border border-line">2XL</div>
                                                    </div>
                                                    </div>
                                
                                            </div>
                                        </div>
                                        <div class="product-infor mt-4 lg:mb-7">
                                            <div class="product-name text-title duration-300"><a href="{% url "service_detail" service.business.business_slug service.service_slug %}">{{ service.name }}</a></div>
                                                {% if product.variation %}
                                                    <div class="list-color list-color-image max-md:hidden flex items-center gap-3 flex-wrap duration-500">
                                                        
                                                            <div class="color-item w-12 h-12 rounded-xl duration-300 relative" key="0">
                                                                <img src="./assets/images/product/color/white.png" alt="color" class="rounded-xl w-full h-full object-cover">
                                                                <div class="tag-action bg-black text-white caption2 capitalize px-1.5 py-0.5 rounded-sm">white</div>
                                                            </div>
                                                        
                                                            <div class="color-item w-12 h-12 rounded-xl duration-300 relative" key="1">
                                                                <img src="./assets/images/product/color/purple.png" alt="color" class="rounded-xl w-full h-full object-cover">
                                                                <div class="tag-action bg-black text-white caption2 capitalize px-1.5 py-0.5 rounded-sm">purple</div>
                                                            </div>
                                                        
                                                    </div>
                                                {% endif %}
                                            
                                    <div class="product-price-block flex items-center gap-2 flex-wrap mt-1 duration-300 relative z-[1]">
                                    <div class="product-price text-title">${{ service.price }}</div>
                                    
                                        </div>
                                    </div>
                                </div>
                            
                        </div>
                    {% endfor %}
                </div>
                {% endif %}
                
                <div class="list-pagination w-full flex items-center justify-center gap-4 mt-10"></div>
                <div class="item mb-4">
                    <div class="heading6">About {{ business.business_name }}</div>
                    <div class="text-secondary mt-2 lg:w-[560px] w-full text-align: justify">
                        {{ business.description }}
                    </div>
                </div>
                <div class="w-1/4 mr-8" style="margin-top: 10px; margin-bottom: 10px;">
                    <div class="list-featrue">
                        <div class="item">
                            <div class="heading6">Opening Hours:</div>
                            {% for opening_hour in opening_hours %}
                            <div class="flex items-center mt-2">
                                <div class="text-secondary whitespace-nowrap">{{ opening_hour.get_day_display }}:</div>
                                {% if opening_hour.is_closed %}
                                <div class='text-title text-black whitespace-nowrap ml-2'>Closed</div>
                                {% else %}
                                {% with opening_time=opening_hour.opening_time|time:"g:sa" closing_time=opening_hour.closing_time|time:"g:sa" %}
                                <div class='text-black whitespace-nowrap ml-2'><b>{{ opening_time }} - {{ closing_time }}</b></div>
                                {% endwith %}
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



{% endblock content %}